// auto generated by kmigrator
// KMIGRATOR:0004_auto_20210220_0613:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDMuMS42IG9uIDIwMjEtMDItMjAgMDY6MTMKCmZyb20gZGphbmdvLmRiIGltcG9ydCBtaWdyYXRpb25zLCBtb2RlbHMKaW1wb3J0IGRqYW5nby5kYi5tb2RlbHMuZGVsZXRpb24KCgpjbGFzcyBNaWdyYXRpb24obWlncmF0aW9ucy5NaWdyYXRpb24pOgoKICAgIGRlcGVuZGVuY2llcyA9IFsKICAgICAgICAoJ19kamFuZ29fc2NoZW1hJywgJzAwMDNfYXV0b18yMDIxMDIxM18xODQzJyksCiAgICBdCgogICAgb3BlcmF0aW9ucyA9IFsKICAgICAgICBtaWdyYXRpb25zLlJlbmFtZU1vZGVsKAogICAgICAgICAgICBvbGRfbmFtZT0ndGlja2V0X2Fzc2lnbmVlc19tYW55JywKICAgICAgICAgICAgbmV3X25hbWU9J3RpY2tldF93YXRjaGVyc19tYW55JywKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J3RpY2tldCcsCiAgICAgICAgICAgIG5hbWU9J2Fzc2lnbmVlJywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLkZvcmVpZ25LZXkoYmxhbms9VHJ1ZSwgZGJfY29sdW1uPSdhc3NpZ25lZScsIG51bGw9VHJ1ZSwgb25fZGVsZXRlPWRqYW5nby5kYi5tb2RlbHMuZGVsZXRpb24uRE9fTk9USElORywgcmVsYXRlZF9uYW1lPScrJywgdG89J19kamFuZ29fc2NoZW1hLnVzZXInKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J3RpY2tldCcsCiAgICAgICAgICAgIG5hbWU9J2V4ZWN1dG9yJywKICAgICAgICAgICAgZmllbGQ9bW9kZWxzLkZvcmVpZ25LZXkoYmxhbms9VHJ1ZSwgZGJfY29sdW1uPSdleGVjdXRvcicsIG51bGw9VHJ1ZSwgb25fZGVsZXRlPWRqYW5nby5kYi5tb2RlbHMuZGVsZXRpb24uRE9fTk9USElORywgcmVsYXRlZF9uYW1lPScrJywgdG89J19kamFuZ29fc2NoZW1hLnVzZXInKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J3RpY2tldCcsCiAgICAgICAgICAgIG5hbWU9J2ZsYXROdW1iZXInLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuVGV4dEZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSd0aWNrZXRoaXN0b3J5cmVjb3JkJywKICAgICAgICAgICAgbmFtZT0nYXNzaWduZWUnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuVVVJREZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSd0aWNrZXRoaXN0b3J5cmVjb3JkJywKICAgICAgICAgICAgbmFtZT0nZXhlY3V0b3InLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuVVVJREZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSksCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSd0aWNrZXRoaXN0b3J5cmVjb3JkJywKICAgICAgICAgICAgbmFtZT0nZmxhdE51bWJlcicsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5UZXh0RmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWx0ZXJNb2RlbFRhYmxlKAogICAgICAgICAgICBuYW1lPSd0aWNrZXRfd2F0Y2hlcnNfbWFueScsCiAgICAgICAgICAgIHRhYmxlPSdUaWNrZXRfd2F0Y2hlcnNfbWFueScsCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkRlbGV0ZU1vZGVsKAogICAgICAgICAgICBuYW1lPSd0aWNrZXRfZXhlY3V0b3JzX21hbnknLAogICAgICAgICksCiAgICBdCg==

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Rename model ticket_assignees_many to ticket_watchers_many
--
--
-- Add field assignee to ticket
--
ALTER TABLE "Ticket" ADD COLUMN "assignee" uuid NULL CONSTRAINT "Ticket_assignee_c5ee5cd6_fk_User_id" REFERENCES "User"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "Ticket_assignee_c5ee5cd6_fk_User_id" IMMEDIATE;
--
-- Add field executor to ticket
--
ALTER TABLE "Ticket" ADD COLUMN "executor" uuid NULL CONSTRAINT "Ticket_executor_93500e07_fk_User_id" REFERENCES "User"("id") DEFERRABLE INITIALLY DEFERRED; SET CONSTRAINTS "Ticket_executor_93500e07_fk_User_id" IMMEDIATE;
--
-- Add field flatNumber to ticket
--
ALTER TABLE "Ticket" ADD COLUMN "flatNumber" text NULL;
--
-- Add field assignee to tickethistoryrecord
--
ALTER TABLE "TicketHistoryRecord" ADD COLUMN "assignee" uuid NULL;
--
-- Add field executor to tickethistoryrecord
--
ALTER TABLE "TicketHistoryRecord" ADD COLUMN "executor" uuid NULL;
--
-- Add field flatNumber to tickethistoryrecord
--
ALTER TABLE "TicketHistoryRecord" ADD COLUMN "flatNumber" text NULL;
--
-- Rename table for ticket_watchers_many to Ticket_watchers_many
--
ALTER TABLE "Ticket_assignees_many" RENAME TO "Ticket_watchers_many";
--
-- Delete model ticket_executors_many
--
DROP TABLE "Ticket_executors_many" CASCADE;
CREATE INDEX "Ticket_assignee_c5ee5cd6" ON "Ticket" ("assignee");
CREATE INDEX "Ticket_executor_93500e07" ON "Ticket" ("executor");
COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Delete model ticket_executors_many
--
CREATE TABLE "Ticket_executors_many" ("id" serial NOT NULL PRIMARY KEY, "Ticket_left_id" uuid NOT NULL, "User_right_id" uuid NOT NULL);
--
-- Rename table for ticket_watchers_many to Ticket_watchers_many
--
ALTER TABLE "Ticket_watchers_many" RENAME TO "Ticket_assignees_many";
--
-- Add field flatNumber to tickethistoryrecord
--
ALTER TABLE "TicketHistoryRecord" DROP COLUMN "flatNumber" CASCADE;
--
-- Add field executor to tickethistoryrecord
--
ALTER TABLE "TicketHistoryRecord" DROP COLUMN "executor" CASCADE;
--
-- Add field assignee to tickethistoryrecord
--
ALTER TABLE "TicketHistoryRecord" DROP COLUMN "assignee" CASCADE;
--
-- Add field flatNumber to ticket
--
ALTER TABLE "Ticket" DROP COLUMN "flatNumber" CASCADE;
--
-- Add field executor to ticket
--
ALTER TABLE "Ticket" DROP COLUMN "executor" CASCADE;
--
-- Add field assignee to ticket
--
ALTER TABLE "Ticket" DROP COLUMN "assignee" CASCADE;
--
-- Rename model ticket_assignees_many to ticket_watchers_many
--
ALTER TABLE "Ticket_executors_many" ADD CONSTRAINT "Ticket_executors_many_Ticket_left_id_63fa7114_fk_Ticket_id" FOREIGN KEY ("Ticket_left_id") REFERENCES "Ticket" ("id") DEFERRABLE INITIALLY DEFERRED;
ALTER TABLE "Ticket_executors_many" ADD CONSTRAINT "Ticket_executors_many_User_right_id_a59be095_fk_User_id" FOREIGN KEY ("User_right_id") REFERENCES "User" ("id") DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "Ticket_executors_many_Ticket_left_id_63fa7114" ON "Ticket_executors_many" ("Ticket_left_id");
CREATE INDEX "Ticket_executors_many_User_right_id_a59be095" ON "Ticket_executors_many" ("User_right_id");
COMMIT;

    `)
}
